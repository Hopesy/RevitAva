# Revit æ’ä»¶ä¸­çš„ Avalonia æ ·å¼æ–‡ä»¶ç»„ç»‡æŒ‡å—

## ç›®å½•
- [1. Revit æ’ä»¶çš„ç‰¹æ®Šæ€§](#1-revit-æ’ä»¶çš„ç‰¹æ®Šæ€§)
- [2. æ¨èçš„ç›®å½•ç»“æ„](#2-æ¨èçš„ç›®å½•ç»“æ„)
- [3. æ ·å¼æ–‡ä»¶çš„ Build Action é…ç½®](#3-æ ·å¼æ–‡ä»¶çš„-build-action-é…ç½®)
- [4. æ ·å¼åŠ è½½æ–¹å¼](#4-æ ·å¼åŠ è½½æ–¹å¼)
- [5. ä¸»é¢˜ç³»ç»Ÿè®¾è®¡](#5-ä¸»é¢˜ç³»ç»Ÿè®¾è®¡)
- [6. å®æˆ˜æ¡ˆä¾‹](#6-å®æˆ˜æ¡ˆä¾‹)
- [7. æ€§èƒ½ä¼˜åŒ–å»ºè®®](#7-æ€§èƒ½ä¼˜åŒ–å»ºè®®)
- [8. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#8-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)

---

## 1. Revit æ’ä»¶çš„ç‰¹æ®Šæ€§

### 1.1 ä¸æ ‡å‡† Avalonia åº”ç”¨çš„åŒºåˆ«

| ç‰¹æ€§             | æ ‡å‡† Avalonia åº”ç”¨            | Revit æ’ä»¶                                           |
| ---------------- | ----------------------------- | ---------------------------------------------------- |
| **åº”ç”¨ç”Ÿå‘½å‘¨æœŸ** | ç‹¬ç«‹çš„ App.axaml + Program.cs | å¯„å®¿åœ¨ Revit è¿›ç¨‹ä¸­ï¼Œæ— ç‹¬ç«‹å…¥å£                      |
| **æ¶ˆæ¯å¾ªç¯**     | Avalonia è‡ªå»ºæ¶ˆæ¯å¾ªç¯         | å€Ÿç”¨ Revit çš„ WPF æ¶ˆæ¯å¾ªç¯                           |
| **èµ„æºåŠ è½½**     | ç›´æ¥é€šè¿‡ Application åŠ è½½     | éœ€è¦åœ¨ `IExternalApplication.OnStartup` ä¸­æ‰‹åŠ¨åˆå§‹åŒ– |
| **æ‰“åŒ…æ–¹å¼**     | ç‹¬ç«‹ EXE                      | ç¼–è¯‘ä¸º DLLï¼Œæ‰€æœ‰èµ„æºå¿…é¡»åµŒå…¥ç¨‹åºé›†                   |
| **çƒ­é‡è½½**       | åŸç”Ÿæ”¯æŒ                      | éœ€è¦ HotAvalonia æ‰©å±•                                |

### 1.2 å…³é”®çº¦æŸ

1. **æ—  App.axaml.cs å¯åŠ¨æµç¨‹**ï¼šä¸èƒ½ä¾èµ–ä¼ ç»Ÿçš„ `Application` ç±»å¯åŠ¨
2. **èµ„æºå¿…é¡»åµŒå…¥**ï¼šæ ·å¼æ–‡ä»¶å¿…é¡»è®¾ç½®ä¸º `AvaloniaResource`ï¼Œç¼–è¯‘åˆ° DLL ä¸­
3. **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šAvalonia æ¡†æ¶åœ¨ Revit å¯åŠ¨åæ‰åˆå§‹åŒ–ï¼Œä¸èƒ½åœ¨é™æ€æ„é€ å‡½æ•°ä¸­è®¿é—® UI
4. **ç‰ˆæœ¬éš”ç¦»**ï¼šå¤šä¸ªç‰ˆæœ¬çš„ Revit å¯èƒ½åŠ è½½ä¸åŒé…ç½®çš„æ’ä»¶

---

## 2. æ¨èçš„ç›®å½•ç»“æ„

### 2.1 æ ‡å‡†å¸ƒå±€ï¼ˆæ¨èï¼‰

```
RevitAva/
â”œâ”€â”€ Resources/
â”‚   â”œâ”€â”€ Styles/                    # æ ·å¼èµ„æºç›®å½•
â”‚   â”‚   â”œâ”€â”€ App.axaml              # å…¨å±€åº”ç”¨æ ·å¼ï¼ˆæ¨èï¼‰
â”‚   â”‚   â”œâ”€â”€ Colors.axaml           # é¢œè‰²å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ Brushes.axaml          # ç”»åˆ·å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ Fonts.axaml            # å­—ä½“ä¸æ’ç‰ˆ
â”‚   â”‚   â”œâ”€â”€ Controls/              # æ§ä»¶æ ·å¼
â”‚   â”‚   â”‚   â”œâ”€â”€ Buttons.axaml     # æŒ‰é’®æ ·å¼
â”‚   â”‚   â”‚   â”œâ”€â”€ TextBoxes.axaml   # æ–‡æœ¬æ¡†æ ·å¼
â”‚   â”‚   â”‚   â”œâ”€â”€ DataGrids.axaml   # æ•°æ®ç½‘æ ¼æ ·å¼
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Themes/                # ä¸»é¢˜å˜ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ Light.axaml       # æµ…è‰²ä¸»é¢˜
â”‚   â”‚   â”‚   â”œâ”€â”€ Dark.axaml        # æ·±è‰²ä¸»é¢˜
â”‚   â”‚   â”‚   â””â”€â”€ Revit.axaml       # Revit é£æ ¼ä¸»é¢˜ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â””â”€â”€ Animations.axaml      # åŠ¨ç”»ä¸è¿‡æ¸¡
â”‚   â”œâ”€â”€ Icons/                     # å›¾æ ‡èµ„æº
â”‚   â”‚   â”œâ”€â”€ setting.png
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ Images/                    # å›¾ç‰‡èµ„æº
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ Fonts/                     # è‡ªå®šä¹‰å­—ä½“ï¼ˆå¯é€‰ï¼‰
â”‚       â””â”€â”€ ...
â”œâ”€â”€ Views/                         # è§†å›¾æ–‡ä»¶
â”œâ”€â”€ ViewModels/                    # è§†å›¾æ¨¡å‹
â”œâ”€â”€ Application.cs                 # Revit å¤–éƒ¨åº”ç”¨å…¥å£
â””â”€â”€ RevitAva.csproj
```

### 2.2 æ›¿ä»£æ–¹æ¡ˆï¼šæ‰å¹³åŒ–ç»“æ„ï¼ˆå°å‹æ’ä»¶ï¼‰

```
RevitAva/
â”œâ”€â”€ Styles/                        # æ ·å¼æ–‡ä»¶ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
â”‚   â”œâ”€â”€ App.axaml
â”‚   â”œâ”€â”€ Colors.axaml
â”‚   â””â”€â”€ Controls.axaml
â”œâ”€â”€ Resources/                     # ä»…å­˜æ”¾äºŒè¿›åˆ¶èµ„æº
â”‚   â””â”€â”€ Icons/
â”œâ”€â”€ Views/
â””â”€â”€ ...
```

**é€‰æ‹©å»ºè®®**ï¼š
- **å¤§å‹æ’ä»¶**ï¼ˆ> 5 ä¸ªçª—å£ï¼‰ï¼šä½¿ç”¨ `Resources/Styles/` åˆ†å±‚ç»“æ„
- **å°å‹æ’ä»¶**ï¼ˆ1-3 ä¸ªçª—å£ï¼‰ï¼šä½¿ç”¨ `Styles/` æ‰å¹³åŒ–ç»“æ„

---

## 3. æ ·å¼æ–‡ä»¶çš„ Build Action é…ç½®

### 3.1 æ ·å¼æ–‡ä»¶

> åœ¨ç°ä»£ Avalonia é¡¹ç›®ä¸­ï¼Œåªè¦ä½ çš„æ–‡ä»¶åç¼€æ˜¯ .axamlï¼ŒAvalonia çš„ SDK é»˜è®¤å°±ä¼šè‡ªåŠ¨å°†å…¶è¯†åˆ«ä¸º AvaloniaXamlã€‚é€šå¸¸ä¸éœ€è¦åœ¨ .csproj é‡Œå†™ä»»ä½•ä»£ç ã€‚

* è¿™æ˜¯ä¸“é—¨ç”¨äº .axaml æ–‡ä»¶çš„æ„å»ºæ“ä½œã€‚
* å®ƒä¼šå…ˆç¼–è¯‘ XAML ä»£ç ï¼ˆæ£€æŸ¥è¯­æ³•é”™è¯¯ã€ä¼˜åŒ–æ€§èƒ½ï¼‰ï¼Œç„¶åå†åµŒå…¥åˆ°ç¨‹åºé›†ä¸­ã€‚

```xml
<!--ç”±äºç‰¹æ®ŠåŸå› æ‰‹åŠ¨æ·»åŠ -->
<ItemGroup>
  <AvaloniaXaml Include="Resources\Styles\**\*.axaml" />
</ItemGroup>
```

### 3.2 å›¾ç‰‡èµ„æºé…ç½®

> Avaloniaæœ‰è‡ªå·±çš„ä¸€å¥—èµ„æºç®¡ç†ç³»ç»Ÿï¼Œä¸ä¾èµ–äº Windows ç‰¹æœ‰çš„èµ„æºç³»ç»Ÿï¼ˆä¸ºäº†è·¨å¹³å°ï¼‰ï¼Œå¦‚æœéœ€è¦åœ¨ Avalonia ä¸­ä½¿ç”¨å¿…é¡»è®¾ç½® AvaloniaResource

* æ‰“åŒ…æ–¹å¼ï¼š AvaloniaResource ä¼šå°†æ–‡ä»¶ä»¥ç‰¹å®šçš„äºŒè¿›åˆ¶æ ¼å¼åµŒå…¥åˆ°ç”Ÿæˆçš„ .dll ç¨‹åºé›†ä¸­ã€‚
* è®¿é—®åè®®ï¼š åªæœ‰è®¾ç½®ä¸º AvaloniaResource çš„æ–‡ä»¶ï¼Œæ‰èƒ½é€šè¿‡ Avalonia ç‰¹æœ‰çš„ URI åè®® avares:// æ¥è®¿é—®ã€‚

```xml
<ItemGroup>
  <!-- å›¾æ ‡å’Œå›¾ç‰‡ -->
  <None Remove="Resources\Icons\*.png" />
  <Resource Include="Resources\Icons\*.png" />
  <!-- å¦‚æœéœ€è¦åœ¨ Avalonia ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º AvaloniaResource -->
  <AvaloniaResource Include="Resources\Images\*.png" />
  <AvaloniaResource Include="Assets\*.png" />
</ItemGroup>
```
```C#
// åªæœ‰ Build Action æ˜¯ AvaloniaResourceï¼Œä¸‹é¢è¿™è¡Œä»£ç æ‰æœ‰æ•ˆ
var bitmap = new Bitmap(AssetLoader.Open(new Uri("avares://MyProjectName/Assets/logo.png")));
```
---

## 4. æ ·å¼åŠ è½½æ–¹å¼
> Colors/Brushes (é¢œè‰²/ç”»åˆ·)é€šå¸¸å®šä¹‰åœ¨ <ResourceDictionary> ä¸­ï¼ŒControls (æŒ‰é’®/æ–‡æœ¬æ¡†)é€šå¸¸å®šä¹‰åœ¨ <Styles> ä¸­ã€‚

* ResourceInclude ç”¨äºåŠ è½½å˜é‡ã€é¢œè‰²ã€ç”»åˆ·ã€è½¬æ¢å™¨ã€‚
* StyleInclude $ ç”¨äºåŠ è½½æ§ä»¶çš„è§†è§‰å¤–è§‚ï¼ˆSetters, Templatesï¼‰ã€‚


### 4.1 æ–¹å¼ä¸€ï¼šä½¿ç”¨ App.axamlï¼ˆæ¨èï¼‰

#### åˆ›å»º App.axaml
åœ¨ `Resources/Styles/App.axaml`ï¼š

```xml
<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Application.Styles>
        <!-- åŸºç¡€ä¸»é¢˜ï¼ˆå¿…é€‰å…¶ä¸€ï¼ŒåŸç”Ÿæ˜¯ç©ºçš„ï¼Œä¸åŠ è½½ä¸»é¢˜æ§ä»¶ä¸æ˜¾ç¤ºï¼‰ -->
        <!-- <FluentTheme /> -->
        <semiTheme:SemiTheme xmlns:semiTheme="clr-namespace:Semi.Avalonia;assembly=Semi.Avalonia" />
        <!-- è‡ªå®šä¹‰æ ·å¼ -->
        <StyleInclude Source="/Resources/Styles/Controls/Buttons.axaml"/>
        <StyleInclude Source="/Resources/Styles/Controls/TextBoxes.axaml"/>
    </Application.Styles>

    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- åˆå¹¶èµ„æºå­—å…¸ -->
                <ResourceInclude Source="/Resources/Styles/Colors.axaml"/>
                <ResourceInclude Source="/Resources/Styles/Brushes.axaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Application.Resources>
</Application>
```

#### åœ¨ Application.cs ä¸­åŠ è½½

```csharp
using Avalonia;
using Avalonia.Markup.Xaml;

namespace RevitAva;

public class Application : IExternalApplication
{
    public Result OnStartup(UIControlledApplication application)
    {
        // 1. åˆå§‹åŒ– Host
        Host.Start();

        // 2. åˆå§‹åŒ– Avalonia
        AppBuilder.Configure<Avalonia.Application>()
            .UsePlatformDetect()
            .LogToTrace()
            .SetupWithoutStarting(); // ä¸å¯åŠ¨å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

        // 3. åŠ è½½æ ·å¼ï¼ˆæ–¹å¼ Aï¼šä½¿ç”¨ App.axamlï¼‰
        var app = new MyAvaloniaApp();
        Avalonia.Application.Current = app;

        // 4. å…¶ä»–åˆå§‹åŒ–...
        CreateRibbon(application);

        return Result.Succeeded;
    }
}

// è‡ªå®šä¹‰ Application ç±»
public class MyAvaloniaApp : Avalonia.Application
{
    public override void Initialize()
    {
        // åŠ è½½ App.axaml
        AvaloniaXamlLoader.Load(this);
    }
}
```

#### ğŸ“ App.axaml çš„è·¯å¾„å¼•ç”¨è§„åˆ™

```xml
<!-- âœ… æ¨èï¼šä½¿ç”¨ avares:// ç»å¯¹è·¯å¾„ -->
<StyleInclude Source="avares://RevitAva/Resources/Styles/Colors.axaml"/>

<!-- âœ… å¯ç”¨ï¼šç›¸å¯¹äºå½“å‰æ–‡ä»¶çš„è·¯å¾„ -->
<StyleInclude Source="Colors.axaml"/>          <!-- App.axaml åŒçº§ -->
<StyleInclude Source="Controls/Buttons.axaml"/> <!-- å­æ–‡ä»¶å¤¹ -->

<!-- âœ… å¯ç”¨ï¼šé¡¹ç›®æ ¹ç›®å½•ç›¸å¯¹è·¯å¾„ -->
<StyleInclude Source="/Resources/Styles/Colors.axaml"/>

<!-- âŒ é”™è¯¯ï¼šç»å¯¹æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼ˆè¿è¡Œæ—¶ä¸å­˜åœ¨ï¼‰ -->
<StyleInclude Source="C:\...\Colors.axaml"/>
```

### 4.2 æ–¹å¼äºŒï¼šä»£ç åŠ¨æ€åŠ è½½ï¼ˆå½“å‰æ–¹å¼ï¼‰

**å½“å‰é¡¹ç›®ä½¿ç”¨çš„æ–¹æ³•**ï¼š

```csharp
public Result OnStartup(UIControlledApplication application)
{
    // åˆå§‹åŒ– Avalonia
    AppBuilder.Configure<Avalonia.Application>()
        .UsePlatformDetect()
        .LogToTrace()
        .SetupWithoutStarting();

    // ç›´æ¥æ·»åŠ ä¸»é¢˜
    Avalonia.Application.Current!.Styles.Add(new SemiTheme());

    // åŠ è½½è‡ªå®šä¹‰æ ·å¼
    LoadCustomStyles();

    return Result.Succeeded;
}

private void LoadCustomStyles()
{
    var app = Avalonia.Application.Current;

    // æ–¹æ³• Aï¼šä»åµŒå…¥èµ„æºåŠ è½½
    var uri = new Uri("avares://RevitAva/Resources/Styles/Buttons.axaml");
    var style = AvaloniaRuntimeXamlLoader.Load(uri) as Styles;
    if (style != null)
        app.Styles.Add(style);

    // æ–¹æ³• Bï¼šåŠ è½½ ResourceDictionary
    var resourceUri = new Uri("avares://RevitAva/Resources/Styles/Brushes.axaml");
    var resources = AvaloniaRuntimeXamlLoader.Load(resourceUri) as ResourceDictionary;
    if (resources != null)
        app.Resources.MergedDictionaries.Add(resources);
}
```

### 4.3 æ–¹æ³•å¯¹æ¯”

| æ–¹å¼          | ä¼˜ç‚¹                                    | ç¼ºç‚¹                       | é€‚ç”¨åœºæ™¯                 |
| ------------- | --------------------------------------- | -------------------------- | ------------------------ |
| **App.axaml** | ç»“æ„æ¸…æ™°ã€XAML è¯­æ³•ç®€æ´ã€æ”¯æŒè®¾è®¡å™¨é¢„è§ˆ | éœ€è¦è‡ªå®šä¹‰ Application ç±»  | å¤§å‹é¡¹ç›®ã€å¤šçª—å£åº”ç”¨     |
| **ä»£ç åŠ è½½**  | çµæ´»ã€å¯åŠ¨æ€æ§åˆ¶åŠ è½½é¡ºåº                | ä»£ç å†—é•¿ã€ä¸æ”¯æŒè®¾è®¡æ—¶é¢„è§ˆ | å°å‹æ’ä»¶ã€éœ€åŠ¨æ€åˆ‡æ¢ä¸»é¢˜ |

---

## 5. ä¸»é¢˜ç³»ç»Ÿè®¾è®¡

### 5.1 å•ä¸»é¢˜æ–¹æ¡ˆï¼ˆæœ€ç®€å•ï¼‰

> ç›´æ¥ä½¿ç”¨ Semi.Avalonia æˆ– FluentTheme,Semiå®Œå…¨é€‚é…äº† Avalonia åŸç”Ÿçš„ ThemeVariant æœºåˆ¶,ä¸éœ€è¦ä»»ä½•å¤æ‚çš„ ResourceDictionary æ›¿æ¢æ“ä½œï¼Œåªéœ€è¦ä¿®æ”¹å…¨å±€å±æ€§å³å¯åˆ‡æ¢ä¸»é¢˜

```csharp
// Application.cs
Avalonia.Application.Current!.Styles.Add(new SemiTheme());
```

è‡ªå®šä¹‰é¢œè‰²è¦†ç›–ï¼ˆColors.axamlï¼‰ï¼š

```xml
<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <!-- è¦†ç›– Semi ä¸»é¢˜çš„é»˜è®¤é¢œè‰² -->
    <Color x:Key="SemiPrimaryColor">#007ACC</Color>
    <Color x:Key="SemiSuccessColor">#52C41A</Color>

    <!-- è‡ªå®šä¹‰é¢œè‰² -->
    <Color x:Key="RevitBlue">#0E6DAC</Color>
    <Color x:Key="RevitGray">#3C3C3C</Color>

    <!-- ç”»åˆ· -->
    <SolidColorBrush x:Key="RevitBlueBrush" Color="{StaticResource RevitBlue}"/>
</ResourceDictionary>
```

### 5.2 å¤šä¸»é¢˜æ–¹æ¡ˆï¼ˆæ·±è‰²/æµ…è‰²åˆ‡æ¢ï¼‰

#### å®šä¹‰ä¸»é¢˜èµ„æº

**Light.axaml**:
```xml
<ResourceDictionary xmlns="https://github.com/avaloniaui">
    <Color x:Key="ThemeBackgroundColor">White</Color>
    <Color x:Key="ThemeForegroundColor">Black</Color>
    <SolidColorBrush x:Key="ThemeBackgroundBrush" Color="{StaticResource ThemeBackgroundColor}"/>
    <SolidColorBrush x:Key="ThemeForegroundBrush" Color="{StaticResource ThemeForegroundColor}"/>
</ResourceDictionary>
```

**Dark.axaml**:
```xml
<ResourceDictionary xmlns="https://github.com/avaloniaui">
    <Color x:Key="ThemeBackgroundColor">#1E1E1E</Color>
    <Color x:Key="ThemeForegroundColor">White</Color>
    <SolidColorBrush x:Key="ThemeBackgroundBrush" Color="{StaticResource ThemeBackgroundColor}"/>
    <SolidColorBrush x:Key="ThemeForegroundBrush" Color="{StaticResource ThemeForegroundColor}"/>
</ResourceDictionary>
```

#### è¿è¡Œæ—¶åˆ‡æ¢

```csharp
public class ThemeManager
{
    public static void SwitchTheme(bool isDark)
    {
        var app = Avalonia.Application.Current!;

        // æ¸…ç©ºç°æœ‰èµ„æº
        app.Resources.MergedDictionaries.Clear();

        // åŠ è½½ç›®æ ‡ä¸»é¢˜
        var themeUri = isDark
            ? new Uri("avares://RevitAva/Resources/Styles/Themes/Dark.axaml")
            : new Uri("avares://RevitAva/Resources/Styles/Themes/Light.axaml");

        var themeResources = AvaloniaRuntimeXamlLoader.Load(themeUri) as ResourceDictionary;
        if (themeResources != null)
            app.Resources.MergedDictionaries.Add(themeResources);
    }
}
```

### 5.3 Revit é£æ ¼ä¸»é¢˜ï¼ˆå¯é€‰ï¼‰

æ¨¡ä»¿ Revit åŸç”Ÿç•Œé¢é£æ ¼ï¼š

```xml
<!-- Revit.axaml -->
<ResourceDictionary xmlns="https://github.com/avaloniaui">
    <!-- Revit 2024+ é£æ ¼é¢œè‰² -->
    <Color x:Key="RevitDarkBlue">#0E6DAC</Color>
    <Color x:Key="RevitLightGray">#F0F0F0</Color>
    <Color x:Key="RevitDarkGray">#3C3C3C</Color>
    <Color x:Key="RevitAccent">#FFB81C</Color>

    <!-- å­—ä½“ -->
    <FontFamily x:Key="RevitFont">Segoe UI</FontFamily>
    <system:Double x:Key="RevitFontSize">12</system:Double>
</ResourceDictionary>
```

---

## 6. å®æˆ˜æ¡ˆä¾‹

### 6.1 å®Œæ•´æ”¹é€ å½“å‰é¡¹ç›®

#### Step 1: åˆ›å»º App.axaml

**ä½ç½®**ï¼š`Resources/Styles/App.axaml`

```xml
<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:semiTheme="clr-namespace:Semi.Avalonia;assembly=Semi.Avalonia">

    <Application.Styles>
        <!-- åŸºç¡€ä¸»é¢˜ -->
        <semiTheme:SemiTheme />

        <!-- è‡ªå®šä¹‰æ ·å¼ -->
        <StyleInclude Source="avares://RevitAva/Resources/Styles/Colors.axaml"/>
        <StyleInclude Source="avares://RevitAva/Resources/Styles/Controls/Buttons.axaml"/>
    </Application.Styles>
</Application>
```

#### Step 2: åˆ›å»º Colors.axaml

**ä½ç½®**ï¼š`Resources/Styles/Colors.axaml`

```xml
<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:system="clr-namespace:System;assembly=System.Runtime">

    <!-- é¡¹ç›®ä¸»è‰²è°ƒ -->
    <Color x:Key="PrimaryColor">#007ACC</Color>
    <Color x:Key="SecondaryColor">#68217A</Color>
    <Color x:Key="AccentColor">#FFB900</Color>

    <!-- è¯­ä¹‰åŒ–é¢œè‰² -->
    <Color x:Key="SuccessColor">#52C41A</Color>
    <Color x:Key="WarningColor">#FA8C16</Color>
    <Color x:Key="ErrorColor">#F5222D</Color>

    <!-- ç”»åˆ· -->
    <SolidColorBrush x:Key="PrimaryBrush" Color="{StaticResource PrimaryColor}"/>
    <SolidColorBrush x:Key="SuccessBrush" Color="{StaticResource SuccessColor}"/>
</ResourceDictionary>
```

#### Step 3: åˆ›å»ºæ§ä»¶æ ·å¼

**ä½ç½®**ï¼š`Resources/Styles/Controls/Buttons.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- ä¸»è¦æŒ‰é’® -->
    <Style Selector="Button.primary">
        <Setter Property="Background" Value="{DynamicResource PrimaryBrush}"/>
        <Setter Property="Foreground" Value="White"/>
        <Setter Property="Padding" Value="16,8"/>
        <Setter Property="CornerRadius" Value="4"/>
    </Style>

    <Style Selector="Button.primary:pointerover /template/ ContentPresenter">
        <Setter Property="Background" Value="#005A9E"/>
    </Style>
</Styles>
```

#### Step 4: ä¿®æ”¹ Application.cs

```csharp
using Avalonia;
using Avalonia.Markup.Xaml;
using Semi.Avalonia;

namespace RevitAva;

public class Application : IExternalApplication
{
    public Result OnStartup(UIControlledApplication application)
    {
        CreateRibbon(application);
        Host.Start();

        // åˆå§‹åŒ– Avalonia
        AppBuilder.Configure<RevitAvaloniaApp>()
            .UsePlatformDetect()
            .LogToTrace()
            .SetupWithoutStarting();

        var logger = Host.GetService<ILogger<Application>>();
        logger.LogInformation("RevitAvaæ’ä»¶å¯åŠ¨");
        return Result.Succeeded;
    }

    // ... å…¶ä»–ä»£ç 
}

// è‡ªå®šä¹‰ Avalonia Application
public class RevitAvaloniaApp : Avalonia.Application
{
    public override void Initialize()
    {
        // åŠ è½½ App.axaml
        AvaloniaXamlLoader.Load(this);
    }
}
```

#### Step 5: æ›´æ–° .csproj

```xml
<ItemGroup>
  <!-- æ ·å¼æ–‡ä»¶ -->
  <AvaloniaResource Include="Resources\Styles\**\*.axaml" />

  <!-- å›¾æ ‡ -->
  <None Remove="Resources\Icons\*.png" />
  <Resource Include="Resources\Icons\*.png" />
</ItemGroup>
```

### 6.2 åœ¨ View ä¸­ä½¿ç”¨æ ·å¼

**SettingView.axaml**:

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RevitAva.ViewModels"
        x:DataType="vm:SettingViewModel"
        Title="è®¾ç½®" Width="800" Height="450">

    <Grid Margin="20">
        <StackPanel Spacing="10">
            <!-- ä½¿ç”¨è‡ªå®šä¹‰æ ·å¼ -->
            <Button Classes="primary" Content="ä¿å­˜è®¾ç½®"/>

            <!-- ä½¿ç”¨ Semi ä¸»é¢˜æ ·å¼ -->
            <Button Classes="Success" Theme="{DynamicResource OutlineButton}"
                    Content="ç¡®è®¤"/>

            <!-- ä½¿ç”¨èµ„æºä¸­çš„é¢œè‰² -->
            <Border Background="{DynamicResource PrimaryBrush}"
                    Padding="10">
                <TextBlock Text="ä¸»é¢˜é¢œè‰²æ¼”ç¤º" Foreground="White"/>
            </Border>
        </StackPanel>
    </Grid>
</Window>
```

---

## 7. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 7.1 æ ·å¼æ–‡ä»¶æ‹†åˆ†ç­–ç•¥

```
âœ… å¥½çš„æ‹†åˆ†ï¼ˆæŒ‰åŠŸèƒ½æ¨¡å—ï¼‰
Resources/Styles/
â”œâ”€â”€ Controls/
â”‚   â”œâ”€â”€ Buttons.axaml      (2KB)
â”‚   â”œâ”€â”€ TextBoxes.axaml    (1.5KB)
â”‚   â””â”€â”€ DataGrids.axaml    (3KB)
â””â”€â”€ Themes/
    â”œâ”€â”€ Light.axaml        (1KB)
    â””â”€â”€ Dark.axaml         (1KB)

âŒ è¿‡åº¦æ‹†åˆ†ï¼ˆå½±å“åŠ è½½æ€§èƒ½ï¼‰
Resources/Styles/
â”œâ”€â”€ ButtonPrimary.axaml
â”œâ”€â”€ ButtonSecondary.axaml
â”œâ”€â”€ ButtonDanger.axaml
â””â”€â”€ ... (50+ å°æ–‡ä»¶)
```

**åŸåˆ™**ï¼š
- å•ä¸ªæ–‡ä»¶ < 5KBï¼šåˆå¹¶
- æ–‡ä»¶æ•°é‡ < 10ï¼šåˆç†
- æ–‡ä»¶æ•°é‡ > 20ï¼šè€ƒè™‘åˆå¹¶

### 7.2 èµ„æºå¼•ç”¨ä¼˜åŒ–

```xml
<!-- âœ… æ¨èï¼šä½¿ç”¨ DynamicResource æ”¯æŒä¸»é¢˜åˆ‡æ¢ -->
<Button Background="{DynamicResource PrimaryBrush}"/>

<!-- âœ… æ€§èƒ½ä¼˜å…ˆï¼šä½¿ç”¨ StaticResourceï¼ˆä¸æ”¯æŒè¿è¡Œæ—¶æ›´æ”¹ï¼‰ -->
<Button Background="{StaticResource PrimaryBrush}"/>

<!-- âŒ é¿å…ï¼šç›´æ¥ç¡¬ç¼–ç  -->
<Button Background="#007ACC"/>
```

### 7.3 å»¶è¿ŸåŠ è½½ç­–ç•¥

å¯¹äºå¤§å‹æ’ä»¶ï¼Œå¯æŒ‰éœ€åŠ è½½æ ·å¼ï¼š

```csharp
public class StyleLoader
{
    private static bool _dataGridStylesLoaded = false;

    public static void LoadDataGridStyles()
    {
        if (_dataGridStylesLoaded) return;

        var uri = new Uri("avares://RevitAva/Resources/Styles/Controls/DataGrids.axaml");
        var styles = AvaloniaRuntimeXamlLoader.Load(uri) as Styles;
        Avalonia.Application.Current!.Styles.Add(styles);

        _dataGridStylesLoaded = true;
    }
}

// åœ¨æ‰“å¼€æ•°æ®è¡¨æ ¼çª—å£å‰è°ƒç”¨
StyleLoader.LoadDataGridStyles();
```

---

## 8. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 8.1 æ ·å¼ä¸ç”Ÿæ•ˆ

**é—®é¢˜**ï¼šå®šä¹‰çš„æ ·å¼åœ¨è¿è¡Œæ—¶ä¸èµ·ä½œç”¨

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥ Build Action**
   ```bash
   # ç¡®è®¤æ–‡ä»¶è®¾ç½®ä¸º AvaloniaResource
   # åœ¨ .csproj ä¸­æŸ¥çœ‹
   ```

2. **éªŒè¯èµ„æºåµŒå…¥**
   ```csharp
   var assembly = typeof(Application).Assembly;
   var resources = assembly.GetManifestResourceNames();
   // åº”åŒ…å« "avares://RevitAva/Resources/Styles/..."
   ```

3. **æ£€æŸ¥åŠ è½½é¡ºåº**
   ```csharp
   // æ ·å¼å¿…é¡»åœ¨çª—å£åˆ›å»ºå‰åŠ è½½
   AppBuilder.Configure<RevitAvaloniaApp>()
       .SetupWithoutStarting(); // â† æ­¤æ—¶åŠ è½½æ ·å¼

   // ç„¶åæ‰èƒ½åˆ›å»ºçª—å£
   var window = new SettingView();
   ```

4. **æ£€æŸ¥é€‰æ‹©å™¨è¯­æ³•**
   ```xml
   <!-- âœ… æ­£ç¡® -->
   <Style Selector="Button.primary">

   <!-- âŒ é”™è¯¯ï¼šç¼ºå°‘ç‚¹å· -->
   <Style Selector="Button primary">
   ```

### 8.2 æ‰¾ä¸åˆ°èµ„æºé”®

**é—®é¢˜**ï¼šè¿è¡Œæ—¶æŠ›å‡º `ResourceNotFound` å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š

```xml
<!-- âœ… åœ¨ä½¿ç”¨å‰ç¡®ä¿èµ„æºå·²å®šä¹‰ -->
<Application.Resources>
    <SolidColorBrush x:Key="PrimaryBrush" Color="Blue"/>
</Application.Resources>

<!-- âœ… ä½¿ç”¨ DynamicResource è‡ªåŠ¨ç­‰å¾…èµ„æºåŠ è½½ -->
<Button Background="{DynamicResource PrimaryBrush}"/>

<!-- âŒ StaticResource åœ¨ç¼–è¯‘æ—¶å¿…é¡»å­˜åœ¨ -->
<Button Background="{StaticResource UndefinedBrush}"/>
```

### 8.3 çƒ­é‡è½½ä¸å·¥ä½œ

**é—®é¢˜**ï¼šä¿®æ”¹ .axaml æ–‡ä»¶åæ²¡æœ‰è‡ªåŠ¨åˆ·æ–°

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ç¡®è®¤ HotAvalonia å·²å®‰è£…**
   ```xml
   <PackageReference Include="HotAvalonia" Version="3.0.2" />
   <PackageReference Include="HotAvalonia.Extensions" Version="3.0.2" />
   ```

2. **ç¡®è®¤åœ¨ Debug æ¨¡å¼**
   ```xml
   <PropertyGroup Condition="'$(Configuration)' == 'Debug R26'">
       <DefineConstants>DEBUG;TRACE</DefineConstants>
   </PropertyGroup>
   ```

3. **æ£€æŸ¥è§†å›¾æ˜¯å¦æ ‡è®°çƒ­é‡è½½**
   ```csharp
   // SettingView.axaml.cs
   public partial class SettingView : Window
   {
       public SettingView()
       {
           this.EnableHotReload(); // â† HotAvalonia æ‰©å±•æ–¹æ³•
           InitializeComponent();
       }
   }
   ```

### 8.4 Revit å’Œ Avalonia å›¾æ ‡å†²çª

**é—®é¢˜**ï¼šWPF å’Œ Avalonia åŒæ—¶ä½¿ç”¨æ—¶èµ„æºè·¯å¾„æ··æ·†

**è§£å†³æ–¹æ¡ˆ**ï¼š

```csharp
// Revit åŠŸèƒ½åŒºæŒ‰é’®ï¼ˆä½¿ç”¨ WPF pack URIï¼‰
button.LargeImage = new BitmapImage(
    new Uri("pack://application:,,,/RevitAva;component/Resources/Icons/setting.png"));

// Avalonia çª—å£ï¼ˆä½¿ç”¨ avares URIï¼‰
var image = new Avalonia.Controls.Image
{
    Source = new Bitmap(AssetLoader.Open(
        new Uri("avares://RevitAva/Resources/Icons/setting.png")))
};
```

---

## 9. æœ€ä½³å®è·µæ€»ç»“

### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨ App.axaml é›†ä¸­ç®¡ç†æ ·å¼**ï¼ˆå¤§å‹é¡¹ç›®ï¼‰
2. **æ ·å¼æ–‡ä»¶æ”¾åœ¨ `Resources/Styles/` ç›®å½•**
3. **æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†æ ·å¼æ–‡ä»¶**ï¼ˆæ¯ä¸ª 2-5KBï¼‰
4. **ä½¿ç”¨ `DynamicResource` æ”¯æŒä¸»é¢˜åˆ‡æ¢**
5. **æ‰€æœ‰æ ·å¼æ–‡ä»¶è®¾ç½®ä¸º `AvaloniaResource`**
6. **å®šä¹‰è¯­ä¹‰åŒ–çš„èµ„æºé”®**ï¼ˆå¦‚ `PrimaryBrush` è€Œé `BlueBrush`ï¼‰
7. **åœ¨ Debug æ¨¡å¼ä¸‹å¯ç”¨ HotAvalonia**

### âŒ é¿å…åšæ³•

1. **ä¸è¦åœ¨ Views ä¸­ç¡¬ç¼–ç é¢œè‰²å’Œæ ·å¼**
2. **ä¸è¦ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„åŠ è½½æ ·å¼**ï¼ˆ`C:\...`ï¼‰
3. **ä¸è¦è¿‡åº¦æ‹†åˆ†æ ·å¼æ–‡ä»¶**ï¼ˆ> 20 ä¸ªæ–‡ä»¶ï¼‰
4. **ä¸è¦åœ¨é™æ€æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ– Avalonia**
5. **ä¸è¦æ··ç”¨ WPF å’Œ Avalonia çš„èµ„æºç³»ç»Ÿ**

---

## 10. å¿«é€Ÿæ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] æ‰€æœ‰ `.axaml` æ ·å¼æ–‡ä»¶å·²è®¾ç½® `AvaloniaResource`
- [ ] ç¼–è¯‘è¾“å‡ºç›®å½•åŒ…å«æ‰€æœ‰èµ„æºæ–‡ä»¶ï¼ˆæ£€æŸ¥ `bin/Debug R26/`ï¼‰
- [ ] æ ·å¼åœ¨ `OnStartup` ä¸­æ­£ç¡®åŠ è½½
- [ ] æµ‹è¯•åœ¨å¤šä¸ª Revit ç‰ˆæœ¬ä¸­åŠ è½½æ’ä»¶
- [ ] éªŒè¯ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ï¼ˆå¦‚æœå®ç°ï¼‰
- [ ] ç¡®è®¤çƒ­é‡è½½åœ¨ Debug æ¨¡å¼ä¸‹å·¥ä½œ
- [ ] æ¸…ç†æœªä½¿ç”¨çš„æ ·å¼æ–‡ä»¶å’Œèµ„æº

---

## é™„å½•ï¼šå®Œæ•´ç¤ºä¾‹é¡¹ç›®ç»“æ„

```
RevitAva/
â”œâ”€â”€ Resources/
â”‚   â”œâ”€â”€ Styles/
â”‚   â”‚   â”œâ”€â”€ App.axaml                    # å…¥å£æ ·å¼
â”‚   â”‚   â”œâ”€â”€ Colors.axaml                 # é¢œè‰²å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ Brushes.axaml                # ç”»åˆ·
â”‚   â”‚   â”œâ”€â”€ Fonts.axaml                  # å­—ä½“
â”‚   â”‚   â”œâ”€â”€ Controls/
â”‚   â”‚   â”‚   â”œâ”€â”€ Buttons.axaml
â”‚   â”‚   â”‚   â”œâ”€â”€ TextBoxes.axaml
â”‚   â”‚   â”‚   â”œâ”€â”€ ComboBoxes.axaml
â”‚   â”‚   â”‚   â””â”€â”€ DataGrids.axaml
â”‚   â”‚   â””â”€â”€ Themes/
â”‚   â”‚       â”œâ”€â”€ Light.axaml
â”‚   â”‚       â””â”€â”€ Dark.axaml
â”‚   â”œâ”€â”€ Icons/
â”‚   â”‚   â”œâ”€â”€ setting.png
â”‚   â”‚   â””â”€â”€ start.png
â”‚   â””â”€â”€ Images/
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ SettingView.axaml
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ViewModels/
â”œâ”€â”€ Services/
â”‚   â””â”€â”€ ThemeManager.cs                  # ä¸»é¢˜ç®¡ç†æœåŠ¡
â”œâ”€â”€ Application.cs                       # Revit å…¥å£
â”œâ”€â”€ RevitAvaloniaApp.cs                  # è‡ªå®šä¹‰ Avalonia Application
â”œâ”€â”€ Host.cs
â”œâ”€â”€ appsettings.json
â””â”€â”€ RevitAva.csproj
```

**RevitAvaloniaApp.cs** å®Œæ•´ç¤ºä¾‹ï¼š

```csharp
using Avalonia;
using Avalonia.Markup.Xaml;

namespace RevitAva;

public class RevitAvaloniaApp : Avalonia.Application
{
    public override void Initialize()
    {
        // åŠ è½½ App.axamlï¼ˆä¼šè‡ªåŠ¨åŠ è½½æ‰€æœ‰å¼•ç”¨çš„æ ·å¼ï¼‰
        AvaloniaXamlLoader.Load(this);
    }
}
```

---

## æ€»ç»“

åœ¨ Revit æ’ä»¶å¼€å‘ä¸­ç»„ç»‡ Avalonia æ ·å¼æ–‡ä»¶çš„å…³é”®ç‚¹ï¼š

1. **ä½ç½®**ï¼š`Resources/Styles/` ç›®å½•ï¼ˆæ¨èï¼‰
2. **é…ç½®**ï¼šæ‰€æœ‰ `.axaml` è®¾ç½®ä¸º `AvaloniaResource`
3. **åŠ è½½**ï¼šåœ¨ `IExternalApplication.OnStartup` ä¸­åˆå§‹åŒ–
4. **å¼•ç”¨**ï¼šä½¿ç”¨ `avares://` URI æ–¹æ¡ˆ
5. **ä¼˜åŒ–**ï¼šåˆç†æ‹†åˆ†ã€ä½¿ç”¨ DynamicResourceã€æŒ‰éœ€åŠ è½½

éµå¾ªè¿™äº›æŒ‡å—ï¼Œå¯ä»¥æ„å»ºç»“æ„æ¸…æ™°ã€æ˜“äºç»´æŠ¤ã€æ€§èƒ½ä¼˜è‰¯çš„ Revit æ’ä»¶ UI ç³»ç»Ÿã€‚
